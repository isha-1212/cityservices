<!DOCTYPE html>
<html>
<head>
    <title>Quick Supabase Connection Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .result { padding: 12px; margin: 10px 0; border-radius: 8px; }
        .success { background: #dcfce7; border: 1px solid #16a34a; color: #166534; }
        .error { background: #fef2f2; border: 1px solid #dc2626; color: #991b1b; }
        .info { background: #dbeafe; border: 1px solid #2563eb; color: #1e40af; }
        button { padding: 10px 20px; background: #3b82f6; color: white; border: none; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>
    <h2>üîç Supabase Connection Diagnostic</h2>
    
    <button onclick="testConnection()">Test Connection</button>
    <button onclick="testSignup()">Test Quick Signup</button>
    
    <div id="results"></div>

    <script type="module">
        import { createClient } from 'https://cdn.skypack.dev/@supabase/supabase-js@2';
        
        const supabaseUrl = 'https://iecothmegflxbpvndnru.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImllY290aG1lZ2ZseGJwdm5kbnJ1Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg5NzQ1ODUsImV4cCI6MjA3NDU1MDU4NX0.I4zmPYXfyqNA3ajhyAJlJ5yCLekNWo491BPUDOfcUeI';
        
        const supabase = createClient(supabaseUrl, supabaseKey);
        const results = document.getElementById('results');

        window.testConnection = async function() {
            results.innerHTML = '<div class="result info">üîÑ Testing connection...</div>';
            
            try {
                // Test basic connection
                const { data, error } = await supabase.auth.getSession();
                
                if (error && error.message.includes('Failed to fetch')) {
                    results.innerHTML = `
                        <div class="result error">
                            ‚ùå <strong>Connection Failed</strong><br>
                            Cannot reach Supabase servers. This could be:<br>
                            ‚Ä¢ Network/Internet issue<br>
                            ‚Ä¢ CORS configuration problem<br>
                            ‚Ä¢ Supabase service down<br>
                        </div>
                    `;
                } else {
                    results.innerHTML = `
                        <div class="result success">
                            ‚úÖ <strong>Connection Successful!</strong><br>
                            Supabase is reachable and responding correctly.
                        </div>
                    `;
                }
            } catch (err) {
                results.innerHTML = `
                    <div class="result error">
                        üí• <strong>Connection Error:</strong><br>
                        ${err.message}<br><br>
                        <strong>Possible solutions:</strong><br>
                        ‚Ä¢ Check internet connection<br>
                        ‚Ä¢ Disable VPN/Proxy<br>
                        ‚Ä¢ Try different browser<br>
                    </div>
                `;
            }
        }

        window.testSignup = async function() {
            results.innerHTML = '<div class="result info">üß™ Testing signup...</div>';
            
            // Generate random email
            const randomEmail = `test${Math.random().toString(36).substr(2, 9)}@example.com`;
            
            try {
                const { data, error } = await supabase.auth.signUp({
                    email: randomEmail,
                    password: 'testpass123',
                    options: {
                        emailRedirectTo: undefined
                    }
                });
                
                if (error) {
                    if (error.message.includes('Failed to fetch')) {
                        results.innerHTML = `
                            <div class="result error">
                                üîå <strong>Network Error</strong><br>
                                Cannot connect to Supabase authentication service.<br>
                                Error: ${error.message}
                            </div>
                        `;
                    } else {
                        results.innerHTML = `
                            <div class="result error">
                                ‚ùå <strong>Signup Error</strong><br>
                                ${error.message}
                            </div>
                        `;
                    }
                } else if (data.user) {
                    results.innerHTML = `
                        <div class="result success">
                            ‚úÖ <strong>Signup Successful!</strong><br>
                            Test email: ${randomEmail}<br>
                            User created: ${data.user.id}<br>
                            Email confirmation: ${data.user.email_confirmed_at ? 'Not required' : 'Required'}
                        </div>
                    `;
                }
            } catch (err) {
                results.innerHTML = `
                    <div class="result error">
                        üí• <strong>Signup Test Failed:</strong><br>
                        ${err.message}
                    </div>
                `;
            }
        }
    </script>
</body>
</html>